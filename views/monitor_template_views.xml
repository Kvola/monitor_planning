<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Menus et Actions -->
    <record id="monitor_planning_website_menu" model="website.menu">
        <field name="name">Planification Moniteurs</field>
        <field name="url">/monitor/planning</field>
        <field name="parent_id" ref="website.main_menu" />
        <field name="sequence">50</field>
    </record>

    <!-- Template principal pour la liste des planifications -->
    <template id="monitor_planning_template" name="Planification des Moniteurs">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container mt-4">
                    <!-- En-tête -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h1 class="text-primary">
                                <i class="fa fa-calendar"></i> Planification des Moniteurs d'École
                                du Dimanche </h1>
                            <p class="lead">Consultez et imprimez les planifications des
                                interventions</p>
                        </div>
                    </div>

                    <!-- Filtres et navigation -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fa fa-filter"></i> Filtres et Options </h5>
                                </div>
                                <div class="card-body">
                                    <form method="get" class="row g-3">
                                        <div class="col-md-3">
                                            <label for="school_id" class="form-label">École</label>
                                            <select name="school_id" id="school_id"
                                                class="form-select">
                                                <option value="">Toutes les écoles</option>
                                                <t t-foreach="schools" t-as="school">
                                                    <option t-att-value="school.id"
                                                        t-att-selected="'selected' if school.id == selected_school_id else None">
                                                        <t t-esc="school.name" />
                                                    </option>
                                                </t>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="monitor_id" class="form-label">Moniteur</label>
                                            <select name="monitor_id" id="monitor_id"
                                                class="form-select">
                                                <option value="">Tous les moniteurs</option>
                                                <t t-foreach="monitors" t-as="monitor">
                                                    <option t-att-value="monitor.id"
                                                        t-att-selected="'selected' if monitor.id == selected_monitor_id else None">
                                                        <t t-esc="monitor.name" />
                                                    </option>
                                                </t>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label for="date_from" class="form-label">Du</label>
                                            <input type="date" name="date_from" id="date_from"
                                                class="form-control" t-att-value="date_from" />
                                        </div>
                                        <div class="col-md-2">
                                            <label for="date_to" class="form-label">Au</label>
                                            <input type="date" name="date_to" id="date_to"
                                                class="form-control" t-att-value="date_to" />
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">&#160;</label>
                                            <div class="d-grid">
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fa fa-search"></i> Filtrer </button>
                                            </div>
                                        </div>
                                    </form>

                                    <!-- Boutons d'action -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <div class="btn-group" role="group">
                                                <a href="/monitor/planning/calendar"
                                                    class="btn btn-outline-info">
                                                    <i class="fa fa-calendar-alt"></i> Vue
                                                    Calendrier </a>
                                                <a href="/monitor/planning/pdf"
                                                    class="btn btn-outline-success" target="_blank">
                                                    <i class="fa fa-file-pdf"></i> Télécharger PDF </a>
                                                <button onclick="window.print()"
                                                    class="btn btn-outline-secondary">
                                                    <i class="fa fa-print"></i> Imprimer cette page </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistiques rapides -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center bg-primary text-white">
                                <div class="card-body">
                                    <h3 t-esc="len(plannings)" />
                                    <p class="mb-0">Total Planifications</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center bg-info text-white">
                                <div class="card-body">
                                    <h3
                                        t-esc="len(plannings.filtered(lambda p: p.state == 'planned'))" />
                                    <p class="mb-0">Planifiées</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center bg-warning text-white">
                                <div class="card-body">
                                    <h3
                                        t-esc="len(plannings.filtered(lambda p: p.state == 'confirmed'))" />
                                    <p class="mb-0">Confirmées</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center bg-success text-white">
                                <div class="card-body">
                                    <h3
                                        t-esc="len(plannings.filtered(lambda p: p.state == 'completed'))" />
                                    <p class="mb-0">Terminées</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Liste des planifications groupées par semaine -->
                    <div class="row">
                        <div class="col-12">
                            <t t-if="not plannings">
                                <div class="alert alert-info text-center">
                                    <i class="fa fa-info-circle fa-2x mb-3"></i>
                                    <h4>Aucune planification trouvée</h4>
                                    <p>Aucune planification ne correspond aux critères sélectionnés.</p>
                                </div>
                            </t>

                            <t t-else="">
                                <t t-foreach="weekly_plannings.values()" t-as="week_data">
                                    <div class="card mb-4">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">
                                                <i class="fa fa-calendar-week"></i> Semaine du <t
                                                    t-esc="week_data['week_start'].strftime('%d/%m/%Y')" />
                                                au <t
                                                    t-esc="week_data['week_end'].strftime('%d/%m/%Y')" />
                                                <span
                                                    class="badge bg-secondary ms-2">
                                                    <t t-esc="len(week_data['plannings'])" />
                                                intervention(s) </span>
                                            </h5>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-hover mb-0">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Heure</th>
                                                            <th>École</th>
                                                            <th>Moniteur</th>
                                                            <th>Sujet</th>
                                                            <th>État</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="week_data['plannings']"
                                                            t-as="planning">
                                                            <tr>
                                                                <td>
                                                                    <t t-if="planning.planned_date">
                                                                        <strong
                                                                            t-esc="planning.planned_date.strftime('%d/%m/%Y')" />
                                                                        <br />
                                                                        <small class="text-muted"
                                                                            t-esc="planning.planned_date.strftime('%A')" />
                                                                    </t>
                                                                    <t t-else="">
                                                                        <span class="text-muted">Date
                                                                            non définie</span>
                                                                    </t>
                                                                </td>
                                                                <td>
                                                                    <t t-set="start_time"
                                                                        t-value="planning.start_time or 0" />
                                                                    <t t-set="end_time"
                                                                        t-value="planning.end_time or 0" />
                                                                    <t
                                                                        t-if="start_time and end_time">
                                                                        <span class="fw-bold">
                                                                            <t
                                                                                t-esc="'{:02d}:{:02d}'.format(int(start_time), int((start_time % 1) * 60))" />
                                                                            - <t
                                                                                t-esc="'{:02d}:{:02d}'.format(int(end_time), int((end_time % 1) * 60))" />
                                                                        </span>
                                                                        <br />
                                                                        <small class="text-muted"> (<t
                                                                                t-esc="round(end_time - start_time, 2)" />
                                                                            h) </small>
                                                                    </t>
                                                                    <t t-else="">
                                                                        <span class="text-muted">Horaire
                                                                            non défini</span>
                                                                    </t>
                                                                </td>
                                                                <td>
                                                                    <strong
                                                                        t-esc="planning.school_id.name if planning.school_id else 'École non définie'" />
                                                                </td>
                                                                <td>
                                                                    <strong
                                                                        t-esc="planning.monitor_id.name if planning.monitor_id else 'Moniteur non défini'" />
                                                                    <t
                                                                        t-if="planning.substitute_monitor_id">
                                                                        <br />
                                                                        <small class="text-warning">
                                                                            <i
                                                                                class="fa fa-exchange-alt"></i>
                                                                            Remplacé par: <t
                                                                                t-esc="planning.substitute_monitor_id.name" />
                                                                        </small>
                                                                    </t>
                                                                </td>
                                                                <td>
                                                                    <t
                                                                        t-esc="planning.topic or 'Non défini'" />
                                                                    <t
                                                                        t-if="planning.expected_participants">
                                                                        <br />
                                                                        <small class="text-muted">
                                                                            <i class="fa fa-users"></i>
                                                                            <t
                                                                                t-esc="planning.expected_participants" />
                                                                            participants attendus </small>
                                                                    </t>
                                                                </td>
                                                                <td>
                                                                    <t t-set="state_class"
                                                                        t-value="'secondary'" />
                                                                    <t
                                                                        t-if="planning.state == 'planned'"
                                                                        t-set="state_class"
                                                                        t-value="'info'" />
                                                                    <t
                                                                        t-if="planning.state == 'confirmed'"
                                                                        t-set="state_class"
                                                                        t-value="'warning'" />
                                                                    <t
                                                                        t-if="planning.state == 'completed'"
                                                                        t-set="state_class"
                                                                        t-value="'success'" />
                                                                    <t
                                                                        t-if="planning.state == 'cancelled'"
                                                                        t-set="state_class"
                                                                        t-value="'danger'" />

                                                                    <span
                                                                        t-att-class="'badge bg-' + state_class">
                                                                        <t
                                                                            t-if="planning.state == 'planned'">
                                                                            Planifiée</t>
                                                                        <t
                                                                            t-elif="planning.state == 'confirmed'">
                                                                            Confirmée</t>
                                                                        <t
                                                                            t-elif="planning.state == 'completed'">
                                                                            Terminée</t>
                                                                        <t
                                                                            t-elif="planning.state == 'cancelled'">
                                                                            Annulée</t>
                                                                        <t t-else=""
                                                                            t-esc="planning.state or 'Non défini'" />
                                                                    </span>

                                                                    <t t-try="">
                                                                        <t
                                                                            t-if="planning.is_overdue">
                                                                            <br />
                                                                            <span
                                                                                class="badge bg-danger">
                                                                                <i
                                                                                    class="fa fa-exclamation-triangle"></i>
                                                                                En retard </span>
                                                                        </t>
                                                                        <t t-except="" />
                                                                    </t>
                                                                </td>
                                                                <td>
                                                                    <a
                                                                        t-att-href="'/monitor/planning/' + str(planning.id)"
                                                                        class="btn btn-sm btn-outline-primary">
                                                                        <i class="fa fa-eye"></i>
                                                                        Détails </a>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Template pour la vue calendrier des planifications - VERSION CORRIGÉE -->
    <template id="monitor_planning_calendar_template" name="Calendrier des Planifications">
        <t t-call="website.layout">
            <!-- Styles CSS intégrés -->
            <link rel="stylesheet" href="/monitor_planning/static/src/css/monitor_planning_calendar.css" />
            <div id="wrap">
                <div class="container-fluid mt-4">
                    <!-- En-tête avec actions rapides -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h1 class="text-primary mb-2">
                                <i class="fa fa-calendar-alt"></i> Calendrier des Planifications </h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="/monitor/planning">Planifications</a>
                                    </li>
                                    <li class="breadcrumb-item active">Calendrier</li>
                                </ol>
                            </nav>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <a href="/monitor/planning" class="btn btn-outline-secondary">
                                    <i class="fa fa-list"></i> Vue Liste </a>
                                <a href="/monitor/planning/pdf" class="btn btn-outline-success"
                                    target="_blank">
                                    <i class="fa fa-file-pdf"></i> PDF </a>
                            </div>
                        </div>
                    </div>

                    <!-- Filtres et navigation -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <!-- Navigation mois -->
                                        <div class="col-md-6">
                                            <div
                                                class="d-flex justify-content-start align-items-center">
                                                <a
                                                    t-att-href="'/monitor/planning/calendar?year=' + str(prev_year) + '&amp;month=' + str(prev_month)"
                                                    class="btn btn-outline-primary me-3">
                                                    <i class="fa fa-chevron-left"></i> Précédent </a>
                                                <h3 class="mb-0 me-3" t-esc="month_name" />
                                                <a
                                                    t-att-href="'/monitor/planning/calendar?year=' + str(next_year) + '&amp;month=' + str(next_month)"
                                                    class="btn btn-outline-primary"> Suivant <i
                                                        class="fa fa-chevron-right"></i>
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Filtres -->
                                        <div class="col-md-6">
                                            <form method="get"
                                                class="d-flex justify-content-end align-items-center">
                                                <div class="me-3">
                                                    <select name="status"
                                                        class="form-select form-select-sm">
                                                        <option value="">Tous les statuts</option>
                                                        <option value="planned"
                                                            t-att-selected="'selected' if selected_status == 'planned' else None">
                                                            Planifié</option>
                                                        <option value="confirmed"
                                                            t-att-selected="'selected' if selected_status == 'confirmed' else None">
                                                            Confirmé</option>
                                                        <option value="completed"
                                                            t-att-selected="'selected' if selected_status == 'completed' else None">
                                                            Terminé</option>
                                                    </select>
                                                </div>
                                                <div class="me-3">
                                                    <select name="monitor_id"
                                                        class="form-select form-select-sm">
                                                        <option value="">Tous les moniteurs</option>
                                                        <t t-foreach="monitors" t-as="monitor">
                                                            <option t-att-value="monitor.id"
                                                                t-att-selected="'selected' if monitor.id == selected_monitor_id else None"
                                                                t-esc="monitor.name" />
                                                        </t>
                                                    </select>
                                                </div>
                                                <input type="hidden" name="year"
                                                    t-att-value="current_year" />
                                                <input type="hidden" name="month"
                                                    t-att-value="current_month" />
                                                <button type="submit"
                                                    class="btn btn-sm btn-primary me-2">
                                                    <i class="fa fa-filter"></i> Filtrer </button>
                                                <a
                                                    t-att-href="'/monitor/planning/calendar?year=' + str(current_year) + '&amp;month=' + str(current_month)"
                                                    class="btn btn-sm btn-secondary">
                                                    <i class="fa fa-times"></i> Reset </a>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Légende des statuts -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body py-2">
                                    <div
                                        class="d-flex justify-content-center align-items-center flex-wrap">
                                        <small class="me-4">
                                            <span class="badge bg-info me-1"></span> Planifié </small>
                                        <small class="me-4">
                                            <span class="badge bg-warning me-1"></span> Confirmé </small>
                                        <small class="me-4">
                                            <span class="badge bg-success me-1"></span> Terminé </small>
                                        <small class="me-4">
                                            <span class="badge bg-secondary me-1"></span> Annulé </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calendrier principal -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-bordered calendar-table mb-0">
                                            <thead>
                                                <tr class="table-primary">
                                                    <th class="text-center py-3 fw-bold">Lundi</th>
                                                    <th class="text-center py-3 fw-bold">Mardi</th>
                                                    <th class="text-center py-3 fw-bold">Mercredi</th>
                                                    <th class="text-center py-3 fw-bold">Jeudi</th>
                                                    <th class="text-center py-3 fw-bold">Vendredi</th>
                                                    <th class="text-center py-3 fw-bold">Samedi</th>
                                                    <th class="text-center py-3 fw-bold">Dimanche</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Générer le calendrier -->
                                                <t t-set="today" t-value="datetime.date.today()" />
                                                <t t-set="start_of_month" t-value="first_day" />
                                                <t t-set="end_of_month" t-value="last_day" />

                                                <!-- Calculer le premier lundi à afficher -->
                                                <t t-set="calendar_start"
                                                    t-value="start_of_month - timedelta(days=start_of_month.weekday())" />
                                                <!-- Calculer le dernier dimanche à afficher -->
                                                <t t-set="calendar_end"
                                                    t-value="end_of_month + timedelta(days=(6 - end_of_month.weekday()))" />

                                                <!-- Générer les semaines -->
                                                <t t-set="current_date" t-value="calendar_start" />
                                                <t t-while="current_date &lt;= calendar_end">
                                                    <tr class="calendar-week">
                                                        <!-- Générer les 7 jours de la semaine -->
                                                        <t t-foreach="range(7)" t-as="day_offset">
                                                            <t t-set="display_date"
                                                                t-value="current_date + timedelta(days=day_offset)" />
                                                            <t t-set="date_key"
                                                                t-value="display_date.strftime('%Y-%m-%d')" />
                                                            <t t-set="is_current_month"
                                                                t-value="display_date.month == current_month" />
                                                            <t t-set="is_today"
                                                                t-value="display_date == today" />
                                                            <t t-set="is_weekend"
                                                                t-value="day_offset in [5, 6]" />
                                                            <t t-set="day_plannings"
                                                                t-value="daily_plannings.get(date_key, [])" />

                                                            <td class="calendar-day p-2"
                                                                t-att-class="('other-month' if not is_current_month else '') + (' today-highlight' if is_today else '') + (' weekend-day' if is_weekend and is_current_month else '')"
                                                                t-att-data-date="date_key"
                                                                t-att-onclick="'openDayModal(\'' + date_key + '\')'">

                                                                <!-- En-tête du jour -->
                                                                <div
                                                                    class="d-flex justify-content-between align-items-start mb-1">
                                                                    <span class="day-number"
                                                                        t-att-class="'text-primary' if is_today else ''"
                                                                        t-esc="display_date.day" />
                                                                    <t t-if="day_plannings">
                                                                        <span
                                                                            class="badge bg-primary rounded-pill small"
                                                                            t-esc="len(day_plannings)" />
                                                                    </t>
                                                                </div>

                                                                <!-- Planifications du jour -->
                                                                <t t-if="day_plannings">
                                                                    <div class="planning-container">
                                                                        <t
                                                                            t-foreach="day_plannings[:4]"
                                                                            t-as="planning">
                                                                            <t t-set="status_class">
                                                                                <t
                                                                                    t-if="planning.state == 'planned'">
                                                                                    state-planned</t>
                                                                                <t
                                                                                    t-elif="planning.state == 'confirmed'">
                                                                                    state-confirmed</t>
                                                                                <t
                                                                                    t-elif="planning.state == 'completed'">
                                                                                    state-completed</t>
                                                                                <t t-else="">
                                                                                    state-cancelled</t>
                                                                            </t>

                                                                            <div
                                                                                class="planning-item small"
                                                                                t-att-class="status_class"
                                                                                t-att-data-planning-id="planning.id"
                                                                                t-att-onclick="'event.stopPropagation(); openPlanningDetails(' + str(planning.id) + ');'"
                                                                                t-att-title="(planning.monitor_id.name if planning.monitor_id else 'Moniteur ND') + ' - ' + (planning.school_id.name if planning.school_id else 'École ND')">

                                                                                <!-- Heure si
                                                                                disponible -->
                                                                                <t
                                                                                    t-set="start_time"
                                                                                    t-value="planning.start_time or 0" />
                                                                                <t t-if="start_time">
                                                                                    <span
                                                                                        class="fw-bold">
                                                                                        <t
                                                                                            t-esc="'{:02d}:{:02d}'.format(int(start_time), int((start_time % 1) * 60))" />
                                                                                    </span>
                                                                                </t>

                                                                                <!-- Nom du moniteur
                                                                                (tronqué) -->
                                                                                <div
                                                                                    class="text-truncate">
                                                                                    <t
                                                                                        t-esc="planning.monitor_id.name[:12] if planning.monitor_id else 'Moniteur ND'" />
                                                                                </div>
                                                                            </div>
                                                                        </t>

                                                                        <!-- Indicateur s'il y a
                                                                        plus de planifications -->
                                                                        <t
                                                                            t-if="len(day_plannings) > 4">
                                                                            <div
                                                                                class="text-center mt-1">
                                                                                <small
                                                                                    class="text-muted">
                                                                                    +<t
                                                                                        t-esc="len(day_plannings) - 4" />
                                                                                    autres </small>
                                                                            </div>
                                                                        </t>
                                                                    </div>
                                                                </t>
                                                            </td>
                                                        </t>
                                                    </tr>
                                                    <t t-set="current_date"
                                                        t-value="current_date + timedelta(days=7)" />
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Résumé mensuel -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="fa fa-chart-bar"></i> Résumé du mois </h5>
                                    <div class="row text-center">
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-info mb-1" t-esc="total_planned" />
                                                <small>Planifiées</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-warning mb-1"
                                                    t-esc="total_confirmed" />
                                                <small>Confirmées</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-success mb-1"
                                                    t-esc="total_completed" />
                                                <small>Terminées</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-primary mb-1"
                                                    t-esc="total_plannings" />
                                                <small>Total</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scripts JavaScript -->
            <script src="/static/src/js/dynamic_planning_pdf.js"></script>
        </t>
    </template>


    <template id="monitor_planning_day_detail_template" name="Détail du Jour - Planifications">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container mt-4">
                    <!-- En-tête -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h1 class="text-primary mb-2">
                                <i class="fa fa-calendar-day"></i>
                                <t t-esc="date_formatted" />
                            </h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="/monitor/planning">Planifications</a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="/monitor/planning/calendar">Calendrier</a>
                                    </li>
                                    <li class="breadcrumb-item active">
                                        <t t-esc="date.strftime('%d/%m/%Y')" />
                                    </li>
                                </ol>
                            </nav>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <a
                                    t-att-href="'/monitor/planning/calendar?year=' + str(date.year) + '&amp;month=' + str(date.month)"
                                    class="btn btn-outline-secondary">
                                    <i class="fa fa-arrow-left"></i> Retour au Calendrier </a>
                                <button class="btn btn-primary" data-bs-toggle="modal"
                                    data-bs-target="#addPlanningModal">
                                    <i class="fa fa-plus"></i> Ajouter </button>
                            </div>
                        </div>
                    </div>

                    <!-- Statistiques du jour -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="fa fa-chart-bar"></i> Résumé du jour </h5>
                                    <div class="row text-center">
                                        <div class="col-md-3">
                                            <div class="border rounded p-3 bg-light">
                                                <h4 class="text-primary mb-1"
                                                    t-esc="day_stats['total']" />
                                                <small class="text-muted">Total</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-info mb-1"
                                                    t-esc="day_stats['planned']" />
                                                <small class="text-muted">Planifiées</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-warning mb-1"
                                                    t-esc="day_stats['confirmed']" />
                                                <small class="text-muted">Confirmées</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3">
                                                <h4 class="text-success mb-1"
                                                    t-esc="day_stats['completed']" />
                                                <small class="text-muted">Terminées</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Liste des planifications -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">
                                        <i class="fa fa-list"></i> Planifications du jour <span
                                            class="badge bg-light text-dark ms-2"
                                            t-esc="len(plannings)" />
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <t t-if="plannings">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Heure</th>
                                                        <th>Moniteur</th>
                                                        <th>École</th>
                                                        <th>Sujet</th>
                                                        <th>Participants</th>
                                                        <th>Statut</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="plannings" t-as="planning">
                                                        <tr class="planning-row"
                                                            t-att-data-planning-id="planning.id"
                                                            style="cursor: pointer;"
                                                            onclick="window.location.href='/monitor/planning/' + this.getAttribute('data-planning-id')">

                                                            <!-- Heure -->
                                                            <td class="fw-bold">
                                                                <i
                                                                    class="fa fa-clock text-muted me-2"></i>
                                                                <t t-set="start_time"
                                                                    t-value="planning.start_time or 0" />
                                                                <t t-if="start_time">
                                                                    <t
                                                                        t-esc="'{:02d}:{:02d}'.format(int(start_time), int((start_time % 1) * 60))" />
                                                                </t>
                                                                <t t-else="">Non définie</t>

                                                                <t t-set="end_time"
                                                                    t-value="planning.end_time or 0" />
                                                                <t t-if="end_time">
                                                                    <small class="text-muted"> - <t
                                                                            t-esc="'{:02d}:{:02d}'.format(int(end_time), int((end_time % 1) * 60))" />
                                                                    </small>
                                                                </t>
                                                            </td>

                                                            <!-- Moniteur -->
                                                            <td>
                                                                <div
                                                                    class="d-flex align-items-center">
                                                                    <i
                                                                        class="fa fa-user text-muted me-2"></i>
                                                                    <div>
                                                                        <div
                                                                            t-esc="planning.monitor_id.name if planning.monitor_id else 'Moniteur N/D'" />
                                                                        <t
                                                                            t-if="planning.monitor_id and planning.monitor_id.phone">
                                                                            <small
                                                                                class="text-muted d-block">
                                                                                <i
                                                                                    class="fa fa-phone me-1"></i>
                                                                                <t
                                                                                    t-esc="planning.monitor_id.phone" />
                                                                            </small>
                                                                        </t>
                                                                    </div>
                                                                </div>
                                                            </td>

                                                            <!-- École -->
                                                            <td>
                                                                <div
                                                                    class="d-flex align-items-center">
                                                                    <i
                                                                        class="fa fa-school text-muted me-2"></i>
                                                                    <div>
                                                                        <div
                                                                            t-esc="planning.school_id.name if planning.school_id else 'École N/D'" />
                                                                        <t
                                                                            t-if="planning.school_id and planning.school_id.street">
                                                                            <small
                                                                                class="text-muted d-block">
                                                                                <i
                                                                                    class="fa fa-map-marker-alt me-1"></i>
                                                                                <t
                                                                                    t-esc="planning.school_id.street" />
                                                                            </small>
                                                                        </t>
                                                                    </div>
                                                                </div>
                                                            </td>

                                                            <!-- Sujet -->
                                                            <td>
                                                                <t t-if="planning.topic">
                                                                    <div class="text-truncate"
                                                                        style="max-width: 200px;"
                                                                        t-att-title="planning.topic">
                                                                        <i
                                                                            class="fa fa-book text-muted me-2"></i>
                                                                        <t t-esc="planning.topic" />
                                                                    </div>
                                                                </t>
                                                                <t t-else="">
                                                                    <span class="text-muted">Non
                                                                        défini</span>
                                                                </t>
                                                            </td>

                                                            <!-- Participants -->
                                                            <td class="text-center">
                                                                <t
                                                                    t-if="planning.expected_participants">
                                                                    <span class="badge bg-info">
                                                                        <i class="fa fa-users me-1"></i>
                                                                        <t
                                                                            t-esc="planning.expected_participants" />
                                                                    </span>
                                                                </t>
                                                                <t t-else="">
                                                                    <span class="text-muted">-</span>
                                                                </t>
                                                            </td>

                                                            <!-- Statut -->
                                                            <td>
                                                                <t t-set="status_class">
                                                                    <t
                                                                        t-if="planning.state == 'planned'">
                                                                        bg-info</t>
                                                                    <t
                                                                        t-elif="planning.state == 'confirmed'">
                                                                        bg-warning</t>
                                                                    <t
                                                                        t-elif="planning.state == 'completed'">
                                                                        bg-success</t>
                                                                    <t t-else="">bg-secondary</t>
                                                                </t>

                                                                <t t-set="status_text">
                                                                    <t
                                                                        t-if="planning.state == 'planned'">
                                                                        Planifié</t>
                                                                    <t
                                                                        t-elif="planning.state == 'confirmed'">
                                                                        Confirmé</t>
                                                                    <t
                                                                        t-elif="planning.state == 'completed'">
                                                                        Terminé</t>
                                                                    <t t-else="">Inconnu</t>
                                                                </t>

                                                                <span class="badge text-white"
                                                                    t-att-class="status_class">
                                                                    <t t-esc="status_text" />
                                                                </span>
                                                            </td>

                                                            <!-- Actions -->
                                                            <td>
                                                                <div class="btn-group btn-group-sm"
                                                                    role="group">
                                                                    <a
                                                                        t-att-href="'/monitor/planning/' + str(planning.id)"
                                                                        class="btn btn-outline-primary btn-sm"
                                                                        onclick="event.stopPropagation();">
                                                                        <i class="fa fa-eye"></i>
                                                                    </a>
                                                                    <button
                                                                        class="btn btn-outline-secondary btn-sm"
                                                                        onclick="event.stopPropagation(); editPlanning(this);"
                                                                        t-att-data-planning-id="planning.id">
                                                                        <i class="fa fa-edit"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="text-center py-5">
                                            <div class="mb-4">
                                                <i class="fa fa-calendar-times fa-4x text-muted"></i>
                                            </div>
                                            <h4 class="text-muted">Aucune planification</h4>
                                            <p class="text-muted">
                                                Il n'y a aucune planification prévue pour cette
                                                date.
                                            </p>
                                            <button class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#addPlanningModal">
                                                <i class="fa fa-plus"></i> Ajouter une planification </button>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline (optionnel pour une vue plus visuelle) -->
                    <t t-if="plannings">
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            <i class="fa fa-timeline"></i> Timeline du jour </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="timeline">
                                            <t t-foreach="plannings" t-as="planning">
                                                <div class="timeline-item">
                                                    <div class="timeline-marker"
                                                        t-att-class="'bg-info' if planning.state == 'planned' else 'bg-warning' if planning.state == 'confirmed' else 'bg-success'">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <div
                                                            class="d-flex justify-content-between align-items-start">
                                                            <div>
                                                                <h6 class="mb-1">
                                                                    <t t-set="start_time"
                                                                        t-value="planning.start_time or 0" />
                                                                <t
                                                                        t-if="start_time">
                                                                        <t
                                                                            t-esc="'{:02d}:{:02d}'.format(int(start_time), int((start_time % 1) * 60))" />
                                                                    </t>
                                                                    - <t
                                                                        t-esc="planning.monitor_id.name if planning.monitor_id else 'Moniteur N/D'" />
                                                                </h6>
                                                                <p class="mb-1">
                                                                    <strong>
                                                                        <t
                                                                            t-esc="planning.school_id.name if planning.school_id else 'École N/D'" />
                                                                    </strong>
                                                                </p>
                                                                <t t-if="planning.topic">
                                                                    <p class="mb-0 text-muted">
                                                                        <t t-esc="planning.topic" />
                                                                    </p>
                                                                </t>
                                                            </div>
                                                            <span class="badge"
                                                                t-att-class="'bg-info' if planning.state == 'planned' else 'bg-warning' if planning.state == 'confirmed' else 'bg-success'">
                                                                <t
                                                                    t-if="planning.state == 'planned'">
                                                                    Planifié</t>
                                                                <t
                                                                    t-elif="planning.state == 'confirmed'">
                                                                    Confirmé</t>
                                                                <t
                                                                    t-elif="planning.state == 'completed'">
                                                                    Terminé</t>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Styles CSS pour la timeline -->
            <style>
                .planning-row:hover {
                background-color: #f8f9fa !important;
                }

                .timeline {
                position: relative;
                padding-left: 30px;
                }

                .timeline::before {
                content: '';
                position: absolute;
                left: 15px;
                top: 0;
                bottom: 0;
                width: 2px;
                background: #dee2e6;
                }

                .timeline-item {
                position: relative;
                margin-bottom: 20px;
                }

                .timeline-marker {
                position: absolute;
                left: -22px;
                top: 5px;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                border: 3px solid white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }

                .timeline-content {
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                }

                @media (max-width: 768px) {
                .timeline {
                padding-left: 20px;
                }

                .timeline-marker {
                left: -17px;
                width: 25px;
                height: 25px;
                }
                }
            </style>

            <!-- Scripts JavaScript -->
            <script> function editPlanning(element) { const planningId =
                element.getAttribute('data-planning-id'); // Rediriger vers la page d'édition ou
                ouvrir un modal window.location.href = `/monitor/planning/${planningId}/edit`; } //
                Raccourcis clavier document.addEventListener('keydown', function(e) { if (e.key ===
                'Escape') { // Retour au calendrier const year = '<t t-esc="date.year" />'; const
                month = '<t t-esc="date.month" />'; window.location.href =
                `/monitor/planning/calendar?year=${year}&amp;month=${month}`; } }); </script>
        </t>
    </template>


    <!-- Template pour le détail d'une planification -->
    <template id="monitor_planning_detail_template" name="Détail Planification">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container mt-4">
                    <!-- En-tête -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="/monitor/planning">Planifications</a>
                                    </li>
                                    <li class="breadcrumb-item active">Détail</li>
                                </ol>
                            </nav>
                            <h1 class="text-primary">
                                <i class="fa fa-calendar-check"></i>
                                <t t-esc="planning.display_name or planning.name or 'Planification'" />
                            </h1>
                        </div>
                    </div>

                    <!-- Informations principales -->
                    <div class="row mb-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fa fa-info-circle"></i> Informations de la
                                        planification </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <dl class="row">
                                                <dt class="col-sm-4">Date :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-if="planning.planned_date">
                                                        <strong
                                                            t-esc="planning.planned_date.strftime('%d/%m/%Y')" />
                                                        (<t
                                                            t-esc="planning.planned_date.strftime('%A')" />
                                                        ) </t>
                                                    <t t-else="">
                                                        <span class="text-muted">Date non définie</span>
                                                    </t>
                                                </dd>

                                                <dt class="col-sm-4">Horaire :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-set="start_time"
                                                        t-value="planning.start_time or 0" />
                                                    <t t-set="end_time"
                                                        t-value="planning.end_time or 0" />
                                                    <t t-if="start_time and end_time">
                                                        <strong>
                                                            <t
                                                                t-esc="'{:02d}:{:02d}'.format(int(start_time), int((start_time % 1) * 60))" />
                                                            - <t
                                                                t-esc="'{:02d}:{:02d}'.format(int(end_time), int((end_time % 1) * 60))" />
                                                        </strong>
                                                        <small class="text-muted"> (<t
                                                                t-esc="round(end_time - start_time, 2)" />
                                                            h) </small>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="text-muted">Horaire non défini</span>
                                                    </t>
                                                </dd>

                                                <dt class="col-sm-4">École :</dt>
                                                <dd class="col-sm-8">
                                                    <strong
                                                        t-esc="planning.school_id.name if planning.school_id else 'École non définie'" />
                                                </dd>

                                                <dt class="col-sm-4">Moniteur :</dt>
                                                <dd class="col-sm-8">
                                                    <strong
                                                        t-esc="planning.monitor_id.name if planning.monitor_id else 'Moniteur non défini'" />
                                                    <t t-try="">
                                                        <t t-if="planning.substitute_monitor_id">
                                                            <br />
                                                            <span class="text-warning">
                                                                <i class="fa fa-exchange-alt"></i>
                                                                Remplacé par: <strong
                                                                    t-esc="planning.substitute_monitor_id.name" />
                                                            </span>
                                                        </t>
                                                        <t t-except="" />
                                                    </t>
                                                </dd>
                                            </dl>
                                        </div>

                                        <div class="col-md-6">
                                            <dl class="row">
                                                <dt class="col-sm-4">État :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-set="state_class" t-value="'secondary'" />
                                                    <t t-if="planning.state == 'planned'"
                                                        t-set="state_class" t-value="'info'" />
                                                    <t t-if="planning.state == 'confirmed'"
                                                        t-set="state_class" t-value="'warning'" />
                                                    <t t-if="planning.state == 'completed'"
                                                        t-set="state_class" t-value="'success'" />
                                                    <t t-if="planning.state == 'cancelled'"
                                                        t-set="state_class" t-value="'danger'" />

                                                    <span
                                                        t-att-class="'badge bg-' + state_class + ' fs-6'">
                                                        <t t-if="planning.state == 'planned'">
                                                            Planifiée</t>
                                                        <t t-elif="planning.state == 'confirmed'">
                                                            Confirmée</t>
                                                        <t t-elif="planning.state == 'completed'">
                                                            Terminée</t>
                                                        <t t-elif="planning.state == 'cancelled'">
                                                            Annulée</t>
                                                        <t t-else=""
                                                            t-esc="planning.state or 'Non défini'" />
                                                    </span>
                                                </dd>

                                                <dt class="col-sm-4">Sujet :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-esc="planning.topic or 'Non défini'" />
                                                </dd>

                                                <dt class="col-sm-4">Groupe d'âge :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-try="">
                                                        <t
                                                            t-esc="planning.target_age_group or 'Non spécifié'" />
                                                        <t t-except="">Non spécifié</t>
                                                    </t>
                                                </dd>

                                                <dt class="col-sm-4">Participants :</dt>
                                                <dd class="col-sm-8">
                                                    <t t-try="">
                                                        <t t-if="planning.expected_participants">
                                                            <i class="fa fa-users"></i>
                                                            <t
                                                                t-esc="planning.expected_participants" />
                                                            attendus </t>
                                                        <t t-else="">Non spécifié</t>
                                                        <t t-except="">Non spécifié</t>
                                                    </t>

                                                    <t t-try="">
                                                        <t t-if="planning.actual_participants">
                                                            <br />
                                                            <span class="text-success">
                                                                <i class="fa fa-check"></i>
                                                                <t
                                                                    t-esc="planning.actual_participants" />
                                                                réels </span>
                                                        </t>
                                                        <t t-except="" />
                                                    </t>
                                                </dd>
                                            </dl>
                                        </div>
                                    </div>

                                    <t t-try="">
                                        <t t-if="planning.description">
                                            <hr />
                                            <div>
                                                <h6><i class="fa fa-file-text"></i> Description</h6>
                                                <p t-esc="planning.description" />
                                            </div>
                                        </t>
                                        <t t-except="" />
                                    </t>
                                </div>
                            </div>
                        </div>

                        <!-- Panneau latéral -->
                        <div class="col-lg-4">
                            <!-- État et actions -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fa fa-cogs"></i> Actions </h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary"
                                            onclick="window.print()">
                                            <i class="fa fa-print"></i> Imprimer cette fiche </button>
                                        <a href="/monitor/planning"
                                            class="btn btn-outline-secondary">
                                            <i class="fa fa-arrow-left"></i> Retour à la liste </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Informations du moniteur -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fa fa-user"></i> Moniteur </h6>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                        <h5
                                            t-esc="planning.monitor_id.name if planning.monitor_id else 'Moniteur non défini'" />
                                        <t t-if="planning.monitor_id and planning.monitor_id.email">
                                            <p class="mb-1">
                                                <i class="fa fa-envelope"></i>
                                                <a
                                                    t-att-href="'mailto:' + planning.monitor_id.email"
                                                    t-esc="planning.monitor_id.email" />
                                            </p>
                                        </t>
                                        <t t-if="planning.monitor_id and planning.monitor_id.phone">
                                            <p class="mb-0">
                                                <i class="fa fa-phone"></i>
                                                <a t-att-href="'tel:' + planning.monitor_id.phone"
                                                    t-esc="planning.monitor_id.phone" />
                                            </p>
                                        </t>
                                    </div>
                                </div>
                            </div>

                            <!-- Informations de l'école -->
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fa fa-school"></i> École </h6>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                        <h5
                                            t-esc="planning.school_id.name if planning.school_id else 'École non définie'" />
                                        <t t-if="planning.school_id and planning.school_id.street">
                                            <p class="mb-1">
                                                <i class="fa fa-map-marker-alt"></i>
                                                <t t-esc="planning.school_id.street" />
                                                <t t-if="planning.school_id.city">
                                                    <br />
                                                    <t t-esc="planning.school_id.city" />
                                                </t>
                                            </p>
                                        </t>
                                        <t t-if="planning.school_id and planning.school_id.phone">
                                            <p class="mb-0">
                                                <i class="fa fa-phone"></i>
                                                <a t-att-href="'tel:' + planning.school_id.phone"
                                                    t-esc="planning.school_id.phone" />
                                            </p>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Réalisation (si intervention terminée) -->
                    <t t-if="planning.state == 'completed'">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">
                                            <i class="fa fa-check-circle"></i> Réalisation de
                                            l'intervention </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <t t-try="">
                                                    <t
                                                        t-if="planning.actual_start_time and planning.actual_end_time">
                                                        <p>
                                                            <strong>Horaire réel :</strong>
                                                            <t
                                                                t-set="actual_start"
                                                                t-value="planning.actual_start_time" />
                                                            <t
                                                                t-set="actual_end"
                                                                t-value="planning.actual_end_time" />
                                                            <t
                                                                t-esc="'{:02d}:{:02d}'.format(int(actual_start), int((actual_start % 1) * 60))" />
                                                            - <t
                                                                t-esc="'{:02d}:{:02d}'.format(int(actual_end), int((actual_end % 1) * 60))" />
                                                            (<t
                                                                t-esc="round(actual_end - actual_start, 2)" />
                                                            h) </p>
                                                    </t>
                                                    <t t-except="" />
                                                </t>

                                                <t t-try="">
                                                    <t t-if="planning.actual_participants">
                                                        <p>
                                                            <strong>Participants réels :</strong>
                                                            <t t-esc="planning.actual_participants" />
                                                        </p>
                                                    </t>
                                                    <t t-except="" />
                                                </t>
                                            </div>

                                            <div class="col-md-6">
                                                <t t-try="">
                                                    <t t-if="planning.rating">
                                                        <p>
                                                            <strong>Évaluation :</strong>
                                                            <t
                                                                t-foreach="range(int(planning.rating))"
                                                                t-as="star">
                                                                <i class="fa fa-star text-warning"></i>
                                                            </t>
                                                            <t
                                                                t-foreach="range(5 - int(planning.rating))"
                                                                t-as="star">
                                                                <i class="fa fa-star-o text-muted"></i>
                                                            </t>
                                                            (<t t-esc="planning.rating" />/5) </p>
                                                    </t>
                                                    <t t-except="" />
                                                </t>
                                            </div>
                                        </div>

                                        <t t-try="">
                                            <t t-if="planning.monitor_feedback">
                                                <hr />
                                                <div>
                                                    <h6><i class="fa fa-comment"></i> Retour du
                                                        moniteur</h6>
                                                    <p t-esc="planning.monitor_feedback" />
                                                </div>
                                            </t>
                                            <t t-except="" />
                                        </t>

                                        <t t-try="">
                                            <t t-if="planning.supervisor_feedback">
                                                <hr />
                                                <div>
                                                    <h6><i class="fa fa-comment-dots"></i> Retour du
                                                        superviseur</h6>
                                                    <p t-esc="planning.supervisor_feedback" />
                                                </div>
                                            </t>
                                            <t t-except="" />
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Template d'erreur pour PDF -->
    <template id="monitor_planning_pdf_error_template">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-warning text-center">
                                <i class="fa fa-exclamation-triangle fa-3x mb-3"></i>
                                <h3>Impossible de générer le PDF</h3>
                                <p t-esc="error_message" />
                                <div class="mt-3">
                                    <a href="/monitor/planning" class="btn btn-primary">
                                        <i class="fa fa-arrow-left"></i> Retour aux planifications </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- CSS optimisé pour l'impression PDF -->
    <template id="monitor_planning_pdf_assets" name="PDF Assets">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/monitor/planning/static/src/css/monitor_planning_pdf.css" />
        </xpath>
    </template>
</odoo>